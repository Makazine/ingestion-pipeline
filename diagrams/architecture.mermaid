---
title: NDJSON to Parquet Pipeline - Architecture Diagram
---
flowchart TB
    subgraph INGESTION["ðŸ“¥ DATA INGESTION LAYER"]
        direction TB
        S3Input["ðŸ“¦ S3 Input Bucket\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nNDJSON Files (3.5MB)\n~200,000 files/hour\nDate-prefixed naming"]
        
        SQS["ðŸ“® SQS Queue\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ 55 messages/sec\nâ€¢ 15 min visibility\nâ€¢ 14-day retention\nâ€¢ Long polling (20s)"]
        
        DLQ["â˜ ï¸ Dead Letter Queue\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ Failed messages (3x)\nâ€¢ 14-day retention\nâ€¢ Alarm on messages"]
    end
    
    subgraph PROCESSING["âš™ï¸ PROCESSING LAYER"]
        direction TB
        Lambda1["Î» Manifest Builder\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ Validates files\nâ€¢ Groups into 1GB batches\nâ€¢ Distributed locking\nâ€¢ Tracks in DynamoDB\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n512MB | 3min timeout"]
        
        S3Manifest["ðŸ“‹ S3 Manifest Bucket\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nmanifests/yyyy-mm-dd/\nbatch-NNNN.json\n~286 files per batch"]
        
        Quarantine["ðŸš« S3 Quarantine\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nInvalid files\n30-day retention"]
        
        Glue["ðŸ”§ Glue Streaming Job\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ 10 Ã— G.2X workers\nâ€¢ PySpark + Snappy\nâ€¢ 24/7 continuous\nâ€¢ 30s trigger interval\nâ€¢ Checkpoint recovery\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n2-5 min per batch"]
    end
    
    subgraph STORAGE["ðŸ’¾ STORAGE LAYER"]
        direction TB
        DDB["ðŸ—„ï¸ DynamoDB\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nFile Tracking Table\nâ€¢ PK: date_prefix\nâ€¢ SK: file_name\nâ€¢ GSI: status-index\nâ€¢ TTL: 7 days\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nMetrics Table\nâ€¢ Job run stats\nâ€¢ Cost tracking"]
        
        S3Output["ðŸ“¦ S3 Output Bucket\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nmerged-parquet-yyyy-mm-dd/\nâ€¢ Parquet format\nâ€¢ Snappy compression\nâ€¢ 128MB target files\nâ€¢ Intelligent Tiering"]
    end
    
    subgraph MONITORING["ðŸ“Š MONITORING LAYER"]
        direction TB
        EB["âš¡ EventBridge\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nGlue State Changes\nâ€¢ SUCCEEDED\nâ€¢ FAILED\nâ€¢ TIMEOUT\nâ€¢ STOPPED"]
        
        Lambda2["Î» Control Plane\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ State management\nâ€¢ Anomaly detection\nâ€¢ Cost tracking\nâ€¢ Status updates\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n256MB | 1min timeout"]
        
        CW["ðŸ“ˆ CloudWatch\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ Custom metrics\nâ€¢ Dashboard\nâ€¢ Alarms\nâ€¢ Log groups"]
        
        SNS["ðŸ“§ SNS Alerts\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ€¢ Job failures\nâ€¢ DLQ messages\nâ€¢ Anomalies\nâ€¢ Cost alerts"]
    end
    
    %% Data Flow Connections
    S3Input -->|"S3 Event\nNotification"| SQS
    SQS -->|"Poll messages\n(batch: 10)"| Lambda1
    SQS -->|"3x failures"| DLQ
    
    Lambda1 -->|"Track files"| DDB
    Lambda1 -->|"Create manifests\n(1GB batches)"| S3Manifest
    Lambda1 -->|"Invalid files"| Quarantine
    
    S3Manifest -->|"Trigger\nprocessing"| Glue
    Glue -->|"Read\nNDJSON"| S3Input
    Glue -->|"Write\nParquet"| S3Output
    
    %% Monitoring Flow
    Glue -->|"State\nchanges"| EB
    EB -->|"Trigger"| Lambda2
    Lambda2 -->|"Update\nstatus"| DDB
    Lambda2 -->|"Publish\nmetrics"| CW
    Lambda2 -->|"Send\nalerts"| SNS
    
    DLQ -.->|"Alarm"| CW
    CW -.->|"Alert"| SNS
    
    %% Styling
    classDef s3 fill:#ff9f43,stroke:#e17055,color:#fff,stroke-width:2px
    classDef sqs fill:#00cec9,stroke:#00b894,color:#fff,stroke-width:2px
    classDef lambda fill:#fd79a8,stroke:#e84393,color:#fff,stroke-width:2px
    classDef glue fill:#a29bfe,stroke:#6c5ce7,color:#fff,stroke-width:2px
    classDef dynamodb fill:#55efc4,stroke:#00b894,color:#2d3436,stroke-width:2px
    classDef eventbridge fill:#fdcb6e,stroke:#f39c12,color:#2d3436,stroke-width:2px
    classDef cloudwatch fill:#74b9ff,stroke:#0984e3,color:#fff,stroke-width:2px
    classDef sns fill:#fab1a0,stroke:#e17055,color:#2d3436,stroke-width:2px
    classDef dlq fill:#ff7675,stroke:#d63031,color:#fff,stroke-width:2px
    
    class S3Input,S3Manifest,S3Output,Quarantine s3
    class SQS sqs
    class Lambda1,Lambda2 lambda
    class Glue glue
    class DDB dynamodb
    class EB eventbridge
    class CW cloudwatch
    class SNS sns
    class DLQ dlq
